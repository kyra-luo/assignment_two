#!/bin/bash
# CITS 4407 Assignment 2
# Author Zishan Luo
# Student ID 22448064
#!/bin/bash

invalid_format=false

# Function to check if a file is tab-separated and read the TSV header.
# Check if the input is three files or not.
if [ $# -ne 3 ]; then
    echo "Error: Expected 3 input files, received $#"
    exit 1
fi

# Function to check file format and cell consistency
check_file() {
    local file="$1"

    # Check if the file is tab-separated
    if ! awk -F'\t' 'NR==1 {exit !($0 ~ /\t/)}' "$file"; then
        echo "Invalid file format in $file. File is not tab-separated."
        invalid_format=true
        return
    fi

    # Check if the number of cells in each line matched the header
    num_cells_header=$(awk -F'\t' 'NR==1 {print NF; exit}' "$file")
    if ! awk -F'\t' -v header_cells="$num_cells_header" 'NR>1 {if (NF != header_cells) {print "Mismatch in number of cells in line: " $0; exit 1}}' "$file"; then
        invalid_format=true
        return
    fi
}

# Check all input files
for file in "$@"; do
    check_file "$file"
done

# Exit if any file is invalid
if [ "$invalid_format" = true ]; then
    exit 1
fi


for file in "$@"; do
    awk 'BEGIN {FS=OFS="\t"}
    NR==1 {
      col = 0
      for (i=1; i<=NF; i++) {
        if ($i == "Continent") {
          col = i;
          break;
        }
      }
    }
    {
      for (i=1; i<=NF; i++) {
        if (i != col) {
          printf "%s%s", $i, (i == NF ? ORS : OFS)
        }
      }
    }' "$file"
done